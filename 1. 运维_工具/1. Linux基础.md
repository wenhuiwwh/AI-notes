### Linux基础

标签（空格分隔）： Linux运维

---

#### 5.1 cat
 * 命令可以用来**查看文件内容、创建文件、文件合并、追加文件内容**等功能
 * 会一次显示所有的内容，适合**查看内容较少**的文本文件
| 选项| 含义   |
| ---- | -----|
| -b| 对非空输出行编号|
| -n|   对输出的所有行编号|
 Linux中还有一个 `nl` 的命令和 `cat -b` 的效果等价


#### 5.2 more
 * more 命令可以用于分屏显示文件内容，每次只显示一页内容
 * 适合于查看**内容较多**的文本文件
| 操作键| 功能   |
| ---- | -----|
| 空格键| 显示手册页的下一屏|
| Enter键|   一次滚动手册页的一行|
| b | 回滚一屏|
| f| 前滚一屏|
|q| 退出|
|/word| 搜索word字符串|
#### 5.3 grep
* Linux系统中grep命令是一种强大的文本搜索工具

* grep 允许对文本文件进行**模式**查找，所谓模式查找，又被称为正则表达式
|选项|含义|
| ---- | -----|
|-n| 显示匹配行及行号|
| -v| 显示不包含匹配文本的所有行（相当于求反）|
|-i|忽略大小写|

* 常用的两种模式查找
| 参数| 含义|
|----|---|
|^a| 行首，搜寻以a开头的行|
|ke$|行尾，搜寻以ke结束的行|

#### 6.1 echo  文字内容

* 会在终端中显示参数指定的文字，通常会和**重定**向联合使用

#### 6.2 重定向 > 和>>
* Linux允许将命令执行结果**重定**向到一个文件
* 将本应显示在**终端中的内容输出/追加**到指定文件中

其中
* \> 表示输出，会覆盖文件原有的内容
*  \>>表示追加，会将内容追加到已有文件的末尾

#### 6.3 管道 |
* Linux 允许将**一个命令的输出**可以通过管道作为**另一个命令的输入**
* 可以理解现实生活中的管子，管子的一头塞东西进去，另一头取出来，这里 | 的左右分为两端，左端塞东西（写），右端取东西（读）

常用的管道命令有：
* score：分屏显示内容
* grep：在命令执行结果的基础上查询指定的文本

### 01. 关机/重启

|序号|命令|对应英文|作用|
|---|
|01|shutdown 选项 时间|shutdown|关机/重新启动|

#### 1.1 shutdown
* shutdown 命令可以安全 关闭或者重新启动系统
|选项|含义|
|----|---|
|-r| 重新启动|

提示：
* 不指定选项和参数，默认表示1分钟之后关闭电脑
* 远程维护服务器时，最好不要关闭系统，而应该重新启动系统

### 02. 查看或配置网卡信息
|序号|命令|对应英文|作用|
|----|---|---|---|
|01|ifconfig|configure a network interface|查看/配置计算机当前的网卡配置信息|
|02|ping ip 地址|ping|检测到目标ip地址的连接是否正常|

#### 2.1 网卡和IP地址
**网卡**

* 网卡是一个专门负责网络通讯的硬件设备
* IP地址是设置在网卡上的地址信息

我们可以把**电脑**比作**电话**，**网卡**相当于**SIM卡**，**IP地址**相当于**电话号码**

**IP地址**
*  每台联网的电脑上都有IP地址，是保证电脑之间正常通讯的重要设置

注意：每台电脑的IP地址不能相同，否则会出现IP地址冲突，并且没有办法正常通讯

#### 2.2 ifconfig
`ifconfig`可以查看/配置计算机当前的网卡配置信息

```
# 查看网卡配置信息
$ ifconfig
# 查看网卡对应的IP地址
$ ifconfig | grep inet
```
提示：一台计算机中有可能会有一个**物理网卡**和**多个虚拟网卡**,在linux中物理网卡的名字通常以`ensXX`表示
* `127.0.01`被称为本地回环/环回地址，一般用来测试本机网卡是否正常
#### 2.3 ping
```
# 检测到目标主机是否正常连接
$ ping IP地址
# 检测本地网卡工作正常
$ ping 127.0.0.1
```
* ping 一般用于检测当前计算机到目标计算机之间的网络**是否通畅，数值越大，速度越慢**
* `ping`的工作原理与潜水艇的声呐相似，`ping`这个命令就是取自**声呐的声音**
* 网络管理员之间也常将`ping`用作动词`ping ` 一下计算机X,看他是否开着

原理：网络上的机器都有**唯一确定的IP地址**，我们给目标IP地址发送一个数据包，对方就要返回一个数据包，根据返回的数据包以及时间，我们可以确定目标主机的存在
> 提示： 在Linux中，想要终止一个终端程序的执行，绝大多数都可以使用CRTL+C

#### **3.1 ssh基础（重点）**
在Linux中SSH是非常常用的工具，通过SSH客户端，我们可以连接到运行了SSH服务器的远程机器上
![image.png-31.7kB][1]

* **SSH客户端**是一种使用Secure Shell（SSH）协议连接到远程计算机的软件程序
* `SSH`是目前较可靠、专为远程登录会话和其他网络服务提供安全性的协议
  * 利用`SSH 协议`可以有效防止远程管理过程中的信息管理
  * 通过`SSH 协议`可以对所有传输的数据进行加密，也能够防止DNS欺骗和IP欺骗
  * `SSH`的另一项优点是传输的数据可以是经过压缩的，所以可以加快传输的速度

**1) 域名和端口号**
域名
* 由一串**用点分隔的名字组成、例如：`www.itcast.cn`
* 是IP地址的别名，方便用户记忆

端口号
* IP地址：通过IP地址找到网络上的计算机

* 端口号：通过端口号可以找到计算机上运行的应用程序
  * SSH服务器的默认端口号是22，如果是默认端口号，在连接的时候，可以省略
  * 常见服务端口号列表：
    |序号|服务|端口号|
    | ---- | -----|
    |01|SSH服务器|22|
    |02|Web服务器|80|
    |03|HTPS|443|
    |04|FTP服务器|21|

**2) 客户端的简单使用**
```shell
ssh [-p port] user@remote
```
* `user`是在远程机器上的用户名，如果不指定的话默认为当前用户
* `remote`是远程机器的地址，可以是IP/域名，或者是后面会提到的别名
* `port`是SSH Server监听的端口，如果不指定，就为默认值`22`

提示：
* 使用`exit`退出当前用户的登录

注意：
* `ssh`这个终端命令只能在Linux或者`UNIX`系统下使用
* 如果在`Windows`系统中，可以安装`PuTTY`或者`XShell`客户端软件即可

提示：
* 在工作中，SSH服务器的端口号很有可能不是22，如果遇到这种情况就需要使用`-p`选项，指定正确的端口号，否则无法正常连接到服务器

#### 3.2 scp（掌握）
* scp 就是 `secure copy`，是在一个Linux下用来进行远程拷贝文件的命令
* 它的**地址格式与ssh基本相同，需要注意的是**，在指定端口时用的是大写的`-P`，而不是小写的
![image.png-54.7kB][2]
```shell
# 把本地当前目录下的01.py文件 复制到远程家目录下的Desktop/01.py
# 注意：':'后面的路径如果不是绝对路径，则以用户的家目录作为参考路径
scp -P port 01.py user@remote:Desktop/01.py

# 把远程 家目录下的 Desktop/01.py 文件复制到 本地当前目录下的01.py
scp -P port user@remote:Deskptop/01.py 01.py

# 加上 -r 选项可以传送文件夹
# 把当前目录下的 demo 文件夹 复制到 远程 家目录下的 Desktop
scp -r demo user@remote:Desktop

# 把远程家目录下的Desktop复制到当前目录下的demo文件夹
scp -r user@remote:Desktop demo
```
1) 免密码登录
步骤
* 配置公钥
* 执行`ssh-keygen`，即可生成SSH钥匙，一路回车即可
* 上传公钥到服务器
* 执行 `ssh-id -p port user@remote`，可以让远程服务器记住我们的公钥

示意图
![image.png-109.1kB][3]
2) 配置别名
每次都输入`ssh -p port user@remote`，时间久了会觉得很麻烦，特别是当`user`,`remote`和`port`都得输入，而且还不好记忆
而`配置别名`可以让我们进一步偷懒，譬如用：`ssh mac`来代替上面这么一长串，那么就在~/.ssh/config 里面追加以下内容：
```shell
Host mac
     HostName ip地址
     User itheima
     Port 22
```
保存之后，即可用`ssh mac`实现远程登录了，`scp`同样可以使用

#### 01. 用户和权限的基本概念
1.1  基本概念

* 用户是Linux系统工作中重要的一环，用户管理包括 **用户** 与 **组** 管理
* 在Linux系统中，不论是由本机或是远程登录系统，每个系统**都必须拥有一个账号**，并且对于**不同的系统资源拥有不同的使用权限**
* 在Linux中，可以指定每一个用户针对不同的文件或目录的不同权限
* 对文件/目录的权限包括：
|序号| 权限| 英文|缩写|数字代号|
|---|---|---|---|---|
|01|读|read|r|4|
|02|写|write|w|2|
|03|执行|excute|x|1|

1.2 组
* 为了方便用户管理，提出了组的概念，如下图所示

1.3 ls-l扩展
* 可以查看文件夹下文件的详细信息，从左到右依次是：

  * 权限，第1个字符如果是`d`表示目录

  * 硬链接数，通俗地讲，就是有多少种方式，可以访问到当前目录/文件

  * 拥有者，家目录下文件/目录的拥有者通常都是当前用户

  * 组，在Linux中，很多时候，会出现组名和用户名相同的情况，后续会讲

  * 大小

  * 时间

  * 名称

文件或目录权限示例
|目录|拥有者权限|组权限|其它用户权限|
|---|---|---|---|
|-|r|w|-|r|w|-|r|-|-|
|d|r|w|x|r|w|x|r|-|x|

1.4 chmod简单使用（重要）

* chmod 可以修改用户/组 对 文件/目录的权限
* 目录格式如下：
```
chmod +/- rwx 文件名/目录名
```
提示：以上方式会一次性修改`拥有者/组`权限，有关`chmod`的高级用法，后续会讲

1.5 超级用户
* Linux系统中的`root`账号通常**用于系统的维护和管理**，对操作系统的所有资源具有所有访问权限
* 在大多数版本的Linux中，都不推荐直接使用root账号登录系统
* 在Linux安装的过程中，系统会自动创建一个用户账号，而这个默认的用户就称为“标准用户”

sudo
* `su`是`substitute user`的缩写，表示使用另一个用户的身份
* `sudo`命令用来以其它身份来执行命令，预设的身份为`root`
* 用户使用`sudo`时，必须先输入密码，之后有**5分钟的有效期限**，超过期限必须重新输入密码

> 若其未经授权的用户企图使用`sudo`，则会发出警告邮件给管理员

### 02. 组管理 终端命令

> 提示：创建组/删除组的终端命令都需要通过`sudo`执行
|序号|命令|作用|
|---|---|---|
|01|groupadd 组名|添加组|
|02|groupdel 组名|删除组|
|03|cat /etc/group|确认组信息|
|04|chgrp 组名 文件/目录名|修改文件/目录的所属组|
> 提示：
> * 组信息保存在`/etc/group`文件中
> * `/etc`目录是专门用来保存**系统配置信息**的目录

**演练目标**
1. 在`python`用户的桌面文件夹下创建`Python学习`目录
2. 新建`dev`组
3. 将`Python学习`目录的组修改为`dev`

03. 用户管理 终端命令
> 提示：**创建用户/删除用户/修改其他用户密码**的终端命令都需要通过`sudo`执行

3.1 **创建用户/设置密码/删除用户**
|序号|命令|作用|说明|
|---|---|---|---|
|01|useradd -m -g 组 新建用户名|添加新用户|  -m：自动建立用户家目录；  -g： 指定用户所在组，否则会建立一个同名的组|
|02|passwd 用户名|设置用户密码|如果是普通用户，直接用passwd 可以修改自己的账户密码|
|03|userdel -r 用户名|删除用户|-r 选项会自动删除用户家目录|
|04| cat/etc/passwd | grep 用户名|确认用户信息|新建用户后，用户信息会保存|在/etc/passwd文件中|
> 提示：
> * 创建用户时，如果忘记添加`-m`选项指定新用户的家目录--最简单的方法就是**删除用户，重新创建**
> * 创建用户时，默认会创建一个和**用户名**同名的**组名**
> * 用户信息保存在 `/etc/passwd`文件中

3.2  **查看用户信息**
|序号|命令|作用|
|---|---|---|
|01|id[用户名]|查看用户UID和GID信息|
|02|who|查看当前所有登录的用户列表|
|03|whoami|查看当前登录用户的账户名|

**passwd文件**

`/etc/passwd`文件存放的是用户的信息，由6个分号组成的7个信息，分别是

1.  用户名
2. 密码（x，表示加密的密码）

3. UID（用户标识）

4. .GID（组标识）

5. 用户全名或本地账号

6. 家目录

**usermod**

* `usermod` 可以用来设置**用户**的**主组/附加组**和**登录shell**，命令格式如下：
* **主组**：通常在新建用户时指定，在`etc/passwd`的第4列**GID对应的组**
* **附加组**：在`etc/group`中最后一列表示该组的用户列表，用于指定**用户的附加权限**

> 提示：设置了用户的附加组之后，需要重新登录才能生效！
```shell
# 修改用户的主组（passwd中的GID）
usermod -g 组 用户名

# 修改用户的附加组
usermod -G 组 用户名

# 修改用户登录 Shell
usermod -s  /bin/bash
```
> 注意：默认使用useradd添加的用户是没有权限使用sudo以root身份执行命令的，可以使用以下命令，将用户添加到`sudo`附加组中
```shell
usermod -G sudo 用户名
```
**which（重要）**

提示

* `/etc/passwd`是用于保存用户信息的文件

* `/usr/bin/passwd`是用于修改用户密码的程序
* `which`命令可以查看执行命令所在位置，例如：
```
which ls
# 输出
# /bin/ls
which useradd
# 输出
# /usr/sbin/useradd
```
**bin和sbin**
* 在`linux`中，绝大多数可执行文件都保存在`/bin`、`/sbin`、`/usr/bin`、`/usr/sbin`
* `/bin`(binary)是二进制执行文件目录，主要用于具体应用
* `sbin`(system binary）是系统管理员专用的二进制代码存放目录，主要用于系统管理
* `/usr/bin`(usr commands for applications)后期安装的一些软件
* `/usr/sbin`(super user commands for applications)超级用户的一些管理程序
提示：
* `cd`这个终端命令是内置在系统内核中的，没有独立的文件，因此用`which`无法找到`cd`命令的位置

3.3  **切换用户**
|序号|命令|作用|说明|
|---|---|---|---|
|01|su - 用户名|切换用户，并且切换目录|- 可以切换到用户家目录，否则保持位置不变|
|02|exit|退出当前登录账户||

* 不接用户名，可以切换到`root`，但是不推荐，因为不安全
* `exit`示意图如下：
![image.png-77.9kB][4]

#### 04. 修改文件权限

|序号|命令|作用|
|---|---|---|
|01|chown|修改拥有者|
|02|chgrp|修改组|
|03|chmod|修改权限|

命令格式如下：

```shell
# 修改文件|目录的拥有者
chown 用户名 文件名|目录名
# 递归修改文件|目录的组
chgrp -R 组名 文件名|目录名
# 递归修改文件权限
chmod -R 755 文件名|目录名
```

chmod 在设置权限时，可以简单地使用三个数字分别对应拥有者/组 和其他用户的权限

```shell
# 直接修改文件|目录的读|写执行权限，但是不能精确到拥有者|组其他
chmod +/- rwx 文件名|目录名
```
|拥有者|组|其他|
|---|---|---|
|r /w /x|r /w /x|r /w /x|
|4 /2 /1|4 /2 /1|4 /2 /1|

常见数字组合有（`u`表示用户/`g`表示组/`o`表示其他）
* 777===>u=rwx, g=rwx, o=rwx
* 755===>u=rwx, g=rx, o=rx
* 644===>u=rw, g=r, o=r

**chmod演练目标**
1. 将01.py的权限修改为 u=rwx, g=rx,o=r
2. 将123.txt的权限修改为u=rwx,g=rx,o=rx
3. 将test目录以及目录下的所有文件权限修改为`u=rwx, g=rwx, o=rx`

### 系统相关命令
* 本节内容主要是为了方便通过远程终端维护服务器时，查看服务器上当前**系统日期和时间/磁盘空间占用情况/程序执行情况**
* 本小节学习的终端命令基本都是查询命令，通过这些命令对系统资源的使用情况有个了解

**目录**
* 时间和日期

  * `date`

  * `cal`

* 磁盘和目录空间

  * `df`

  * `du`

* 进程信息

  * `ps`
  * `top`
  * `kill`

#### **01. 时间和日期**
|序号|命令|作用|
|---|---|---|
|01|cal|查看日历，-y选项可以查看一年的日历|
|02|date|查看系统时间|

#### **02. 磁盘**
|序号|命令|作用|
|---|---|---|
|01|df -h |disk free显示磁盘剩余空间|
|02|du -h[目录名]|disk usage显示目录下的文件大小|

* 选项说明
|参数|含义|
|---|---|
|-h|以人性化的方式显示文件大小|

### 03. 进程信息
* 所谓**进程**，通俗地说就是**当前正在执行的一个程序**
|序号|命令|作用|
|---|---|---|
|01|ps aux|process status 查看进程的详细状况|
|02|top|动态显示运行中的进程并且排序|
|03|kill[-9]进程代号|终止指定代号的进程，-9表示强行终止|

`ps`默认只会显示当前用户通过终端启动的应用程序
`ps`选项说明功能
|选项|含义|
|---|---|
|a|显示终端上的所有进程，包括其他用户的进程|
|u|显示进程的详细状态|
|x|显示没有控制终端的进程|
> 提示：使用`kill`命令时，最好只终止由当前用户开启的进程，而不要终止`root`身份开启的进程，否则可能导致系统崩溃
> 要退出`top`可以直接输入`q`

### 11. 其它命令
**目标**
* 查找文件：`find`
* 软链接：`ln`
* 打包和压缩：`tar`
* 软件安装：`apt-get`

#### 11.1 查找文件
* `find`命令功能非常强大，通常用来在特定的目录下搜索符合条件的文件
|序号|命令|作用|
|---|---|---|
|01|find[路径] -name ".py"|查找指定路径下扩展名是.py的文件，包括子目录|
* 如果省略路径，表示在当前文件夹下查找

* 之前学习的通配符，在使用`find`命令时同时可用

* 有关`find`的高级使用，在就业班会讲

**演练目标**

1.搜索桌面目录下，文件名包含`1`的文件

```
find -name "*1*"
```
2.搜索桌面目录下，所有以`.txt`为扩展名的文件

```
find -name "*.txt"
```
3.搜索桌面目录下，以数字`1`开头的文件

```
find -name "1*"
```
#### 11.2 软链接
|序号|命令|作用|
|---|---|---|
|01|ln -s 被链接的源文件 链接文件|建立文件的软链接，用通俗的方式讲类似于Windows下的快捷方式|

注意：
1. 没有 `-s`选项建立的是一个硬链接文件
   * 两个文件占用相同大小的硬盘空间，**工作中几乎不会建立文件的硬链接**

2. 源文件要使用绝对路径，不能使用相对路径，这样可以方便移动链接文件后，仍然能够正常使用

#### 11.2 硬链接简介（知道）

> 在使用`ln`创建链接时，如果没有`-s`选项，会创建一个硬链接，而不是软链接

硬链接演练
1. 在`~/Desktop/demo`目录下建立`~/Desktop/demo/b/c/01.py`的硬链接`01_hard`
2. 使用`ls -l`查看文件的硬链接数（硬链接--有多少种方式可以访问文件或者目录）
3. 删除`~/Desktop/demo/b/c/01.py`,并且使用`tree`来确认`demo`目录下的三个链接文件

**文件软硬链接的示意图**
![绘图1.jpg-49.1kB][5]

在Linux中，文件名和文件的数据是分开存储的

<font color="blue">> 提示：</font>

* 在Linux中，只有文件的`硬链接数==0`才会被删除
* 使用`ls -l`可以查看一个文件的硬链接的数量
* 在日常工作中，几乎不会建立文件的硬链接，知道即可

## 12. 打包压缩
* 打包压缩 是日常工作中备份文件的一种方式
* 在不同操作系统中，常用的打包压缩方式是不同的
  * `Windows`常用`tar``
  * ``Mac`常用`zip`
  * `Linux`常用 `tar.gz`
### 12.1 打包/解包
* `tar`是Linux中最常用的备份工具，此命令可以把一系列文件打包到一个大文件中，也可以把一个打包的大文件恢复成一系列文件
* `tar`的命令格式如下：
```shell
# 打包文件
tar -cvf 打包文件.tar 被打包的文件/路径...
# 解包文件
tar -xvf 打包文件.tar
```
* `tar`选项说明
|选项|含义|
|---|--|
|c|生成档案文件，创建打包文件|
|x|解开档案文件|
|v|列出归档解档的详细过程，显示进度|
|f|指定档案文件名称、f后面一定是.tar文件，所以必须放选项最后|
> 注意：`f`选项必须放在最后，其他选项顺序可以随意|

打包解包演练
1. 删除桌面下的所有内容
2. 在桌面下新建三个空白文件`01.py`、`02.py`、`03.py`
3. 将这三个文件打一个`py.tar`的包
4. 新建`tar`目录，并且将`py.tar`移动到`tar`目录下

### 12.2 压缩/解压缩
#### 12.2.1 gzip

* `tar`与`gzip`命令结合可以使用实现文件打包和压缩

  * `tar`只负责打包文件，但不压缩

  * 用`gzip`压缩`tar`打包后的文件，其扩展名一般用`xxx.tar.gz`

命令格式如下：
```shell
# 压缩文件
tar -zcvf 打包文件.tar.gz 被压缩的文件/路径...

# 解压缩文件
tar -zxvf 打包文件.tar.gz

# 解压缩到指定路径
tar -zxvf 打包文件.tar.gz -C 目标路径
```
|选项|含义|
|---|---|
|-C|解压缩到指定目录，注意：要解压缩的目录必须存在|
#### 12.2.2 bzip2（two）

* `tar`与`bzip2`命令结合可以使用实现文件打包和压缩（用法和`gzip`一样）`

  * `tar`只负责打包文件，但不压缩，

  * 用`bzip2`压缩`tar`打包后的文件，其扩展名一般用`xxx.tar.bz2`

* 在tar 命令中有一个选项-j可以调用`bzip2`，从而可以方便的实现压缩和解压缩的功能
* 命令格式如下：

```shell
# 压缩文件
tar -jcvf 打包文件.tar.bz2 被压缩的文件/路径...

# 解压缩文件
tar -jxvf 打包文件.tar.bz2
```
## 13. vi--终端中的编辑器
目标
* `vi`简介
* 打开和新建文件
* 三种工作模式
* 常用命令
* 分屏命令
* 常用命令速查图

### 13.1 vi简介
#### 13.1.1 学习vi的目的
在工作中，要对服务器上的文件进行简单的修改，可以使用`ssh`远程登录到服务器上，并且使用`vi`进行快速的编辑即可

常见需要修改的文件包括：

* **源程序**

* **配置文件**，例如`ssh`的配置文件`~/.ssh/config`

* 在没有图形界面的环境下，要编辑文件，`vi`是最佳选择！
* 每一个要使用Linux的程序员，都应该或多或少的学习一些`vi`的常用命令
#### 13.1.2 vi和vim

在很多`Linux`的发行版中，直接把`vi`做成`vim`的软链接

**vi**

* `vi`是`Visual interface`的简称，是`Linux`中最经典的文本编辑器

* `vi`的核心设计思想--让程序员的手始终保持在键盘的核心区域，就能完成所有的编辑操作

**`vi`的特点：**

* 没有图形界面的功能强大的编辑器
* 只能编辑文本内容，不能对字体、段落进行排版
* 不支持鼠标操作
* 没有菜单
* 只有命令
* `vi`的编辑器在系统管理、服务器管理 编辑文件时，其功能永远不是图形界面的编辑器能比拟的
### 13.2 打开和新建文件
在终端中输入`vi`在后面跟上文件名即可

```shell
vi 文件名
```
* 如果文件已经存在，会直接打开该文件

* 如果文件不存在，会新建一个文件
#### 13.2.1 打开文件并且定位行
在日常生活中，有可能会遇到打开一个文件，并定位到指定行的情况，例如：在开发时，知道某一行代码有错误，可以快速定位到出错代码的位置，这个时候，可以使用以下命令打开文件

```shell
vi 文件名+行数
```
> 提示：如果只带上`+`而不指定行号，会直接定位到文件末尾
#### 13.2.2 异常处理
如果`vi`异常退出，在磁盘上可能会保存有交换文件

下次再使用`vi`编辑该文件时，会看到以下屏幕信息，按下字母`d`可以删除交换文件即可

vi有三种基本工作模式：

1. 命令模式

   * 打开文件首先进入命令模式，是使用`vi`的入口

   * 通过命令对文件进行常规的编辑操作，例如：定位、翻页、复制、粘贴、删除......
   * 在其他图形编辑器下，通过快捷键或者鼠标实现的操作，都在命令模式下实现
2. 末行模式-- 执行保存、退出等操作
   * 要退出`vi`返回到控制台，需要在末行模式下输入命令
   * 末行模式是`vi`的出口
3. 编辑模式--正常的编辑文字
![绘图1.png-17.9kB][6]
> 提示：在`Touch Bar`的Mac电脑上，按ESC不方便，可以使用`CTRL+[`替代

末行模式命令
|命令|英文|功能|
|---|---|---|
|w|write|保存|
|q|quit|退出，如果没有保存，不允许退出|
|q!|quit|强行退出，不保存退出|
|wq|write & quit|保存并退出|
|x||保存并退出|
### 13.4 常用命令
命令线路图

1. 重复次数
   * 在命令模式下，先输入一个数字，再跟上一个命令，可以让该命令重复执行指定次数
2. 移动和选择
   * `vi`之所以快，关键在于能够快速定位到要编辑的代码行
   * 移动命令能够和编辑命令组合使用
3. 编辑操作
   * 删除、复制、粘贴、替换、缩排
4. 撤销和重复

5. 查找替换
6. 编辑

学习提示：

1. `vi`的命令较多，不要期望一下子全部都记住，个别命令忘记了，只是会影响编辑速度而已
2. 在使用`vi`命令时，注意关闭中文输入法

3) 行数移动
|命令|英文|功能|
|---|---|---|
|gg|go|文件顶部|
|G|go|文件末尾|
|数字gg|go|移动到数字对应行数|
|数字G|go|移动到数字对应行数|
|:数字||移动到数字对应行数|
4）屏幕移动
|命令|英文|功能|
|---|---|---|
|Ctrl+b|back|向上翻页|
|Ctrl+f|forwaard|向下翻页|
|H|Head|屏幕顶部|
|M|Middle|屏幕中间|
|L|Low|屏幕底部|
#### 4.2 移动（程序）
**1. 段落移动**

* `vi`中使用空行来区分段落
* 在移动开发时，通常一段功能相关的代码会写在一起--之间没有空行
  |命令|功能|
  |{|上一级|
  |}|下一级|

**2. 括号切换**

* 在程序世界中，`{}`、`[]`、`()`使用频率很高，而且都是成对出现的
  |命令|功能|
  |%|括号匹配及切换|

**3. 标记**

* 在开发时，某一块代码可能需要稍后处理，例如：编辑、查看
* 此时先使用`m`增加一个标记，这样可以在需要时快速地跳转回来或者执行其他编辑操作
* 标记名称 可以是`a~z`或者`A~Z`之间的任意一个字母
* 添加了标记的行如果被删除，标记同时被删除
* 如果在其他行添加了相同名称的标记，之前添加的标记也会被替换掉

|命令|英文|功能|
|---|---|---|
|max|mark|添加标记x，x是a~z或者A~Z之间的任意一个字母|
|'x||直接定位到标记x所在位置|

#### 4.3 选中文本（可视模式）

学习`复制`命令前，应该先学会怎么样选中要复制的代码

在`vi`中要选择文本，需要先使用`Visual`命令切换到可视模式

`vi`中提供了三种可视模式，可以方便程序员选择选中文本的方式

按`ESC`可以放弃选中，返回到命令模式
|命令|模式|功能|
|---|---|---|
|v|可视模式|从光标位置开始按照正常模式选择文本|
|V|可视行模式|选中光标经过的完整行|
|Ctrl+v|可视块模式|垂直方向选中文本|
> 可视模式下，可以和移动命令连用，例如：`ggVG`能够选中所有内容
#### 4.4 撤销和恢复撤销

在学习编辑命令之前，先要知道怎样撤销之前一次错误的编辑动作！
|命令|英文|功能|
|---|---|---|
|u|undo|撤销上次命令|
|CTRL+r|redo|恢复撤销的命令|

#### 4.5  删除文本
|命令|英文|功能|
|---|---|---|
|x|cut|删除光标所在字符，或者选中文字|
|d（移动命令）|delete|删除移动命令对应的内容|
|dd|delete|删除光标所在行，可以ndd复制多行|
|D|delete|删除至行尾|
> 提示：如果使用可视模式已经选中了一段文本，那么无论使用`d`还是`x`，都可以删除选中文本，删除命令可以和移动命令连用，以下是最常用的组合命令：

```shell
* dw             # 从光标位置删除至单词末尾
* d0             # 从光标位置删除到一行的起始位置
* d}             # 从光标位置删除到段落结尾
* ndd            # 从光标位置向下连续删除 n 行
* d代码行G       # 从光标所在行 删除到 指定代码行 之间的所有代码
* d'a            # 从光标所在行 删除到标记a之间的所有代码
```
#### 4.6 复制、粘贴

`vi`中提供一个被复制文本的缓冲区

* 复制命令会将选中的文字保存在缓冲区

* 删除命令删除的文字会被保存在缓冲区

* 在需要的位置，使用粘贴命令可以将缓冲区的文字插入到光标所在位置
  |命令|英文|功能|
  |---|---|---|
  |y（移动命令）|copy|复制|
  |yy|copy|复制一行，可以nyy复制多行|
  |p|paste|粘贴|

提示

* 命令`d`、`x` 类似于图形界面的剪切操作--`CTRL+X`
* 命令 `y` 类似于图形界面的复制操作--`CTRL+C`
* 命令 `p` 类似于图形界面的粘贴操作--`CTRL+V`

* `vi` 中的文本缓冲区同样只有一个，如果后续做过复制、剪切操作，之前缓冲区中的内容会被替换

注意
* `vi` 中的文本缓冲区和系统的剪切板不是同一个
* 所以在其他软件中使用 `CTRL+C `复制的内容，不能在 `vi` 中通过 `P` 命令粘贴
* 可以在编辑模式下使用鼠标右键粘贴
#### 4.7 替换
|命令|英文|功能|工作模式|
|---|---|---|---|
|r|replace|替换当前字符|命令模式|
|R|replace|替换当前行光标后的字符|
> R命令可以进入替换模式，替换完成后，按下`ESC`可以回到命令模式
> 替换命令的作用就是不用进入编辑模式，对文件进行轻量级的修改

#### 4.8  缩排和重复执行

|命令|功能|
|---|---|
|>>|向右增加缩进|
|<<|向左减少缩进|
|.|重复上次命令|
缩排命令在开发程序时，统一增加代码的缩进比较有用！

* 一次性在选中代码前增加4个空格，就叫做增加缩进
* 一次性在选中代码前删除4个空格，就叫做减少缩进
* 在可视模式下，缩排命令只需要使用一个`>`或者`<`

在程序中，缩进通常用来表示代码的归属关系

* 前面空格越少，代码的级别越高
* 前面空格越多，代码的级别越低

#### 4.9 查找
常规查找
|命令|功能|
|---|---|
|/str|查找str|

查找指定内容之后，使用`Next`查找下一个出现的位置：

* `n`: 查找下一个

* `N`: 查找上一个

> 如果不想看到高亮显示，可以随便查找一个文件中不存在的内容即可

单词快速匹配
|命令|功能|
|---|---|
|*|向后查找当前光标所在单词|
|#|向前查找当前光标所在单词|

>  在开发中，通过单词快速匹配，可以快速看到这个单词在其他什么位置使用过
#### 4.10 查找并替换

在`vi`中查找和替换命令需要在末行模式下执行

记忆命令格式：

```shell
:%s///g
```
1) 全局替换

* 一次性替换文件中的所有出现的旧文本

* 命令格式如下：`:%s/旧文本/新文本/g`

2)可视区域替换

* 先选中要替换文字的范围

* 命令格式如下：`:%s/旧文本/新文本/gc`

1. `y`=`yes`替换
2. `n`=`no` 不替换
3. `a`=`all` 替换所有
4. `q`=`quit` 退出替换
5. `l`=`last` 最后一个，并把光标移动到行首
6. `^E` 向下滚屏
7. `^Y` 向上滚屏
### 4.11插入命令
在`vi`中除了常用的`i`进入编辑模式外，还提供了以下命令同样可以进入编辑模式：
|命令|英文|功能|常用|
|---|---|---|---|
|i|insert|在当前字符插入文本|常用|
|I|insert|在行首插入文本|较常用|
|a|append|在当前字符后添加文本|
|A|append|在行末添加文本|较常用|
|o||在当前行后面插入一空行|常用|
|O||在当前行前面插入一空行|常用|
![绘图1.png-10.7kB][7]

**演练1 -- 编辑命令和数字连用**

> 在开发中，可能会遇到连续输入`N`个同样的字符

> 在`Python`中有简单的方法，但是其他语言中通常需要自己输入，例如 `**********`连续10个星号
要实现这个效果可以在命令模式下
1. 输入`10`，表示要重复10次
2. 输入`i`进入编辑模式
3. 输入`*`也就是重复的文字
4. 按下`ESC`返回到命令模式，返回之后`vi`就会把第`2、3`两步的操作重复`10`次
> 提示： 正常开发时，在进入编辑模式之前，不要按数字

**演练2--利用可视块给多行代码增加注释**
> 在开发中，可能会遇到一次性给多行代码增加注释的情况

> 在`Python`中，要给代码增加注释，可以在代码前增加一个`#`

要实现这个效果可以在命令模式下
1. 移动要到添加注释的第一行代码，按`^` 来到行首
2. 按`CTRL+v`进入可视块模式
3. 使用`j`向下连续选中要添加的代码行
4. 输入`I`进入编辑模式，并在行首插入，注意：一定要使用I
5. 输入`#`也就是注释符号
6. 按下`ESC`返回到命令模式，返回之后`vi`会在之前选中的每一行代码前插入`#`
### 05 分屏命令
属于`vi`的高级命令--可以同时编辑和查看多个文件
### 5.1 末行命令扩展
末行命令主要是针对文件进行操作的：保存、保存&退出、搜索&替换、另存、新建、浏览文件
|命令|英文|功能|
|---|---|---|
|:e .|edit|会打开内置的文件浏览器，浏览要当前目录下的文件|
|:n 文件名|new|新建文件|
|:w 文件名|wirte|另存为，但是仍然编辑当前文件，并不会切换文件|
提示： 切换文件之前，必须保证当前这个文件已经被保存！|

已经学习过的末行命令：
|命令|英文|功能|
|---|---|---|
|:w|write|保存|
|:q|quit|退出，如果没有保存，不允许退出|
|:q!|quit|强行退出，不保存退出|
|:wq|rite & quit|保存并退出|
|:x||保存并退出|
|:%s///gc||确认搜索并替换|

在实际开发中，可以使用 `w` 命令阶段性的备份代码

### 5.2分屏命令

使用分屏命令，可以同时编辑和查看多个文件
|命令|英文|功能|
|---|---|---|
|:sp [文件名]|split|横向增加分屏|
|:vsp [文件名]|vertical split| 纵向增加分屏|

**1. 切换分屏窗口**
分屏窗口都是基于`CTRL+W`这个快捷键的，`w`对应的英文单词

|命令|英文|功能|
|---|---|---|
|w|window|切换到下一个窗口|
|r|reverse|互换窗口|
|c|close|关闭当前窗口，但是不能关闭最后一个窗口|
|q|quit|退出当前窗口，如果是最后一个窗口，则关闭vi|
|o|other|关闭其他窗口|

[1]: http://static.zybuluo.com/wangwenhui/7w36wv8ty4kju1hbgz9hgi7k/image.png
[2]: http://static.zybuluo.com/wangwenhui/le941kzarciod63ooxhwnkde/image.png
[3]: http://static.zybuluo.com/wangwenhui/fenh1kmhsg1sf34gqqbalgpz/image.png
[4]: http://static.zybuluo.com/wangwenhui/l801fcxyf3yjz0r89iwrvxjd/image.png
[5]: http://static.zybuluo.com/wangwenhui/eebviytloek29dnc82jo0j1e/%E7%BB%98%E5%9B%BE1.jpg
[6]: http://static.zybuluo.com/wangwenhui/ts28va0ymxsc1ias7bb5rq01/%E7%BB%98%E5%9B%BE1.png
[7]: http://static.zybuluo.com/wangwenhui/apkswcnyzm8ikwsmubsrw4w7/%E7%BB%98%E5%9B%BE1.png